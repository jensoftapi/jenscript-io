// JenScript -  JavaScript HTML5/SVG Library
// version : 1.3.0
// Author : Sebastien Janaud 
// Web Site : http://jenscript.io
// Twitter  : http://twitter.com/JenSoftAPI
// Copyright (C) 2008 - 2017 JenScript, product by JenSoftAPI company, France.
// build: 2017-05-28
// All Rights reserved

!function(){JenScript.PiePlugin=function(a){a=a||{},this.pies=[],this.pieListeners=[],JenScript.Plugin.call(this,{name:"PiePlugin"})},JenScript.Model.inheritPrototype(JenScript.PiePlugin,JenScript.Plugin),JenScript.Model.addMethods(JenScript.PiePlugin,{addPie:function(a){a.plugin=this,this.pies[this.pies.length]=a,this.repaintPlugin()},onProjectionRegister:function(){var a=this;this.getProjection().addProjectionListener("boundChanged",function(){a.repaintPlugin()},"Pie projection bound changed")},addPieListener:function(a,b){var c={action:a,onEvent:b};this.pieListeners[this.pieListeners.length]=c},firePieEvent:function(a,b){for(var c=0;c<this.pieListeners.length;c++)this.pieListeners[c].action===a&&this.pieListeners[c].onEvent(b)},dispatchPieAction:function(a,b,c,d){for(var e=this,f=function(a){"move"===b?a.lockRollover?e.firePieEvent("move",{slice:a,x:c,y:d,device:{x:c,y:d}}):(a.lockRollover=!0,e.firePieEvent("enter",{slice:a,x:c,y:d,device:{x:c,y:d}}),e.firePieEvent("move",{slice:a,x:c,y:d,device:{x:c,y:d}})):"press"===b?e.firePieEvent("press",{slice:a,x:c,y:d,device:{x:c,y:d}}):"release"===b&&e.firePieEvent("release",{slice:a,x:c,y:d,device:{x:c,y:d}})},g=function(a){return"move"===b&&a.lockRollover?(a.lockRollover=!1,e.firePieEvent("exit",{slice:a,x:c,y:d,device:{x:c,y:d}}),!0):void 0},h=0;h<this.pies.length;h++){var i=this.pies[h];if(i.solved)for(var j=0;j<i.slices.length;j++){var k=i.slices[j],l=Math.sqrt((k.sc.y-d)*(k.sc.y-d)+(k.sc.x-c)*(k.sc.x-c)),m=0;l<i.radius?(c>k.sc.x&&d<k.sc.y?m=Math.atan((k.sc.y-d)/(c-k.sc.x)):c>k.sc.x&&d>=k.sc.y?m=Math.atan((k.sc.y-d)/(c-k.sc.x))+2*Math.PI:c<k.sc.x?m=Math.atan((k.sc.y-d)/(c-k.sc.x))+Math.PI:c===k.sc.x&&d<k.sc.y?m=Math.PI/2:c===k.sc.x&&d>k.sc.y&&(m=3*Math.PI/2),JenScript.Math.toDegrees(m)>k.startAngleDegree&&JenScript.Math.toDegrees(m)<k.startAngleDegree+k.extendsDegree?f(k):JenScript.Math.toDegrees(m)<k.startAngleDegree&&k.startAngleDegree+k.extendsDegree>360&&k.startAngleDegree+k.extendsDegree-360>=JenScript.Math.toDegrees(m)?f(k):g(k)):g(k)}}return!1},onPress:function(a,b,c,d){this.dispatchPieAction(a,"press",c,d)},onRelease:function(a,b,c,d){this.dispatchPieAction(a,"release",c,d)},onMove:function(a,b,c,d){this.dispatchPieAction(a,"move",c,d)},onClick:function(a,b,c,d){this.dispatchPieAction(a,"click",c,d)},onEnter:function(a,b,c,d){this.dispatchPieAction(a,"enter",c,d)},onExit:function(a,b,c,d){this.dispatchPieAction(a,"exit",c,d)},paintPlugin:function(a,b){if(b===JenScript.ViewPart.Device)for(var c=0;c<this.pies.length;c++){var d=this.pies[c];if(d.isSolvable()){d.solvePie(),a.deleteGraphicsElement(d.Id),d.svg.pieRoot=(new JenScript.SVGGroup).Id(d.Id).opacity(d.opacity).toSVG(),a.insertSVG(d.svg.pieRoot),void 0!==d.stroke&&d.stroke.strokePie(a,d),void 0!==d.fill&&d.fill.fillPie(a,d);for(var e=0;e<d.effects.length;e++)d.effects[e].paintPieEffect(a,d);for(var e=0;e<d.slices.length;e++){var f=d.slices[e],g=new JenScript.Graphics({definitions:this.svgPluginPartsDefinitions[b],graphics:d.svg.pieRoot,selectors:this.getProjection().getView().svgSelectors});void 0!==f.getSliceLabel()&&f.getSliceLabel().paintPieSliceLabel(g,f)}}}}})}(),function(){JenScript.Pie=function(a){this.init(a)},JenScript.Model.addMethods(JenScript.Pie,{init:function(a){a=a||{},this.name=void 0!==a.name?a.name:"Pie name undefined",this.Id=void 0!==a.Id?a.Id:"pie"+JenScript.sequenceId++,this.x=void 0!==a.x?a.x:0,this.y=void 0!==a.y?a.y:0,this.radius=void 0!==a.radius?a.radius:80,this.opacity=void 0!==a.opacity?a.opacity:1,this.startAngleDegree=void 0!==a.startAngleDegree?a.startAngleDegree:0,this.nature=void 0!==a.nature?a.nature:"User",this.effects=[],this.slices=[],this.svg={},this.paint=!0},repaint:function(){void 0!==this.plugin&&this.paint&&this.plugin.repaintPlugin()},setX:function(a){this.x=a,this.repaint()},getX:function(){return this.x},setY:function(a){this.y=a,this.repaint()},getY:function(){return this.y},setRadius:function(a){this.radius=a,this.repaint()},getRadius:function(){return this.radius},setNature:function(a){this.nature=a,this.repaint()},getNature:function(){return this.nature},setStartAngleDegree:function(a){this.startAngleDegree=a,this.repaint()},getStartAngleDegree:function(){return this.startAngleDegree},addEffect:function(a){this.effects[this.effects.length]=a,this.repaint()},setStroke:function(a){this.stroke=a,this.repaint()},setFill:function(a){this.fill=a,this.repaint()},addSlice:function(a){return a.pie=this,this.slices[this.slices.length]=a,this.repaint(),this},slice:function(a){var b=new JenScript.PieSlice(a);return this.addSlice(b),this},addSlices:function(a){for(var b=0;b<a.length;b++)this.addSlice(a[b]);return this},buildSlice:function(a){var b=360*a.getRatio();a.extendsDegree=b,this.startAngleDegree>360&&(this.startAngleDegree=this.startAngleDegree-360),a.startAngleDegree=this.startAngleDegree,a.endAngleDegree=this.startAngleDegree+b;var c=this.startAngleDegree+b/2;c>360&&(c-=360),a.medianDegree=c;var d=function(a,b,c){return{x:a.x+b*Math.cos(JenScript.Math.toRadians(c)),y:a.y-b*Math.sin(JenScript.Math.toRadians(c))}},e=d(this.buildCenter,a.divergence,c),f=d(e,this.radius,a.startAngleDegree),g=d(e,this.radius,a.endAngleDegree);a.sc=e,a.ss=f,a.se=g;var h="0";b>180&&(h="1"),a.svgPath="M"+f.x+","+f.y+" A"+this.radius+","+this.radius+" 0 "+h+",0 "+g.x+","+g.y+" L"+e.x+","+e.y+" Z",this.startAngleDegree=this.startAngleDegree+b},projection:function(){if("User"==this.nature){var a=this.plugin.getProjection().userToPixel(new JenScript.Point2D(this.x,this.y));this.buildCenterX=a.x,this.buildCenterY=a.y,this.buildCenter=new JenScript.Point2D(this.buildCenterX,this.buildCenterY)}else"Device"==this.nature&&(this.buildCenterX=this.centerX,this.buildCenterY=this.centerY,this.buildCenter=new JenScript.Point2D(this.buildCenterX,this.buildCenterY))},solvePie:function(){{var a=this;!function(){for(var b=0,c=0;c<a.slices.length;c++){var d=a.slices[c];b+=d.value}for(var c=0;c<a.slices.length;c++){var d=a.slices[c],e=d.value/b;d.ratio=e}}()}this.projection();for(var b=0;b<this.slices.length;b++){var c=this.slices[b];this.buildSlice(c)}this.solved=!0},isSolvable:function(){return this.slices.length>0},shift:function(){function a(a){setTimeout(function(){b.startAngleDegree=b.startAngleDegree+36,b.plugin.repaintPlugin()},100*a)}for(var b=this,c=0;10>c;c++)a(c)}})}(),function(){JenScript.PieSlice=function(a){this.init(a)},JenScript.Model.addMethods(JenScript.PieSlice,{init:function(a){if(a=a||{},this.Id=void 0!==a.Id?a.Id:"slice"+JenScript.sequenceId++,this.name=void 0!==a.name?a.name:"PieSlice name undefined",this.value=void 0!==a.value?a.value:1,this.opacity=void 0!==a.opacity?a.opacity:1,this.themeColor=void 0!==a.themeColor?a.themeColor:JenScript.createColor(),this.divergence=void 0!==a.divergence?a.divergence:0,this.value<0)throw new Error("Slice value should be greater than 0")},repaint:function(){void 0!==this.pie&&this.pie.repaint()},setName:function(a){this.name=a},getName:function(){return this.name},setValue:function(a){if(this.value<0)throw new Error("Slice value should be greater than 0");this.value=a,this.repaint()},getValue:function(){return this.value},getRatio:function(){return this.ratio},setSliceLabel:function(a){void 0!==a&&(a.slice=this),this.sliceLabel=a,this.repaint()},getSliceLabel:function(){return this.sliceLabel},setThemeColor:function(a){this.themeColor=a,this.repaint()},getThemeColor:function(){return this.themeColor},setDivergence:function(a){this.divergence=a,this.repaint()},getDivergence:function(){return this.divergence}})}(),function(){JenScript.AbstractPieStroke=function(a){this.init(a)},JenScript.Model.addMethods(JenScript.AbstractPieStroke,{init:function(a){a=a||{},this.name=a.name},strokePie:function(){}}),JenScript.PieDefaultStroke=function(a){this._init(a)},JenScript.Model.inheritPrototype(JenScript.PieDefaultStroke,JenScript.AbstractPieStroke),JenScript.Model.addMethods(JenScript.PieDefaultStroke,{_init:function(a){a=a||{},this.strokeColor=a.strokeColor,this.strokeWidth=void 0!==a.strokeWidth?a.strokeWidth:1,a.name="JenScript.PieDefaultStroke",JenScript.AbstractPieStroke.call(this,a)},strokePie:function(a,b){for(var c=0;c<b.slices.length;c++){var d=b.slices[c],e=void 0!==this.strokeColor?this.strokeColor:d.themeColor,f=(new JenScript.SVGElement).name("path").attr("d",d.svgPath).attr("stroke",e).attr("strokeWidth",this.strokeWidth).attr("fill","none");b.svg.pieRoot.appendChild(f.buildHTML())}}})}(),function(){JenScript.AbstractPieFill=function(a){this.init(a)},JenScript.AbstractPieFill.prototype={init:function(a){a=a||{},this.Id=void 0!==a.Id?a.Id:"_fill"+JenScript.sequenceId++,this.opacity=void 0!==a.opacity?a.opacity:1,this.name=a.name},fillPie:function(){throw new Error("Abstract Pie Fill, this method should be provide by overriden.")}},JenScript.PieDefaultFill=function(a){this.init(a)},JenScript.Model.inheritPrototype(JenScript.PieDefaultFill,JenScript.AbstractPieFill),JenScript.Model.addMethods(JenScript.PieDefaultFill,{_init:function(a){a=a||{},this.fillColor=a.fillColor,a.name="JenScript.PieDefaultFill",JenScript.AbstractPieFill.call(this,a)},fillPie:function(a,b){var c=(new JenScript.SVGGroup).Id(b.Id+this.Id).opacity(this.opacity).toSVG();a.deleteGraphicsElement(b.Id+this.Id);for(var d=0;d<b.slices.length;d++){var e=b.slices[d],f=void 0!==this.fillColor?this.fillColor:e.themeColor,g=(new JenScript.SVGElement).name("path").attr("fill",f).attr("d",e.svgPath).buildHTML(),h=(new JenScript.SVGGroup).Id(b.Id+this.Id+e.Id).opacity(e.opacity).toSVG();a.deleteGraphicsElement(b.Id+this.Id+e.Id),h.appendChild(g),c.appendChild(h)}b.svg.pieRoot.appendChild(c)}})}(),function(){JenScript.AbstractPieEffect=function(a){this.init(a)},JenScript.Model.addMethods(JenScript.AbstractPieEffect,{init:function(a){a=a||{},this.Id=void 0!==a.Id?a.Id:"_effect"+JenScript.sequenceId++,this.name=a.name,this.opacity=void 0!==a.opacity?a.opacity:1,this.projection=void 0},setProjection:function(a){this.projection=a},getProjection:function(){return this.projection},paintPieEffect:function(){throw new Error("Abstract Pie Effect, this method should be provide by overriden.")}}),JenScript.PieReflectionEffect=function(a){this._init(a)},JenScript.Model.inheritPrototype(JenScript.PieReflectionEffect,JenScript.AbstractPieEffect),JenScript.Model.addMethods(JenScript.PieReflectionEffect,{_init:function(a){a=a||{},this.deviation=void 0!==a.deviation?a.deviation:3,this.opacity=void 0!==a.opacity?a.opacity:.3,this.length=void 0!==a.length?a.length:.5,this.verticalOffset=void 0!==a.verticalOffset?a.verticalOffset:0,a.name="JenScript.PieReflectionEffect",JenScript.AbstractPieEffect.call(this,a)},paintPieEffect:function(a,b){var c=(new JenScript.SVGGroup).Id(b.Id+this.Id).opacity(this.opacity).toSVG();a.deleteGraphicsElement(b.Id+this.Id);var d=b.svg.pieRoot.getBBox(),e="clip"+JenScript.sequenceId++,f=(new JenScript.SVGRect).origin(d.x,d.y+d.height).size(d.width,d.height*this.length),g=(new JenScript.SVGClipPath).Id(e).appendPath(f);a.definesSVG(g.toSVG());var h="filter"+JenScript.sequenceId++,i=(new JenScript.SVGFilter).Id(h).from(d.x,d.y).size(d.width,d.height).toSVG(),j=(new JenScript.SVGElement).name("feGaussianBlur").attr("in","SourceGraphic").attr("stdDeviation",this.deviation);i.appendChild(j.buildHTML()),a.definesSVG(i);var k=b.svg.pieRoot.cloneNode(!0);k.removeAttribute("id"),k.setAttribute("filter","url(#"+h+")"),k.setAttribute("transform","translate(0,"+d.height+"), scale(1,-1), translate(0,"+(-2*(d.y+d.height/2)-this.verticalOffset)+")"),k.setAttribute("opacity",this.opacity);var l=(new JenScript.SVGElement).name("g").buildHTML();k.setAttribute("id",k.getAttribute("id")+"_reflection"+JenScript.sequenceId++),l.setAttribute("clip-path","url(#"+e+")"),l.appendChild(k),c.appendChild(l),b.svg.pieRoot.appendChild(c)}}),JenScript.PieLinearEffect=function(a){this._init(a)},JenScript.Model.inheritPrototype(JenScript.PieLinearEffect,JenScript.AbstractPieEffect),JenScript.Model.addMethods(JenScript.PieLinearEffect,{_init:function(a){a=a||{},a.name="JenScript.PieLinearEffect",this.incidence=void 0!==a.incidence?a.incidence:120,this.offset=void 0!==a.offset?a.offset:3,this.fillOpacity=void 0!==a.fillOpacity?a.fillOpacity:1,this.shader=a.shader,this.gradientIds=[],JenScript.AbstractPieEffect.call(this,a)},setIncidence:function(a){this.incidence=a},getIncidence:function(){return this.incidence},setOffserRadius:function(a){this.offset=a},getOffserRadius:function(){return this.offset},paintPieEffect:function(a,b){var c=(new JenScript.SVGGroup).Id(b.Id+this.Id).opacity(this.opacity).toSVG();a.deleteGraphicsElement(b.Id+this.Id);for(var d=0;d<this.gradientIds.length;d++)a.deleteGraphicsElement(this.gradientIds[d]);this.gradientIds=[];for(var d=0;d<b.slices.length;d++){var e=b.slices[d],f="0";e.extendsDegree>180&&(f="1");var g=function(a,b,c){return{x:a.x+b*Math.cos(JenScript.Math.toRadians(c)),y:a.y-b*Math.sin(JenScript.Math.toRadians(c))}},h=g(e.sc,b.radius-this.offset,e.startAngleDegree),i=g(e.sc,b.radius-this.offset,e.endAngleDegree),j=g(e.sc,b.radius-this.offset,this.incidence),k=g(e.sc,b.radius-this.offset,this.incidence+180),l=["0%","49%","51%","100%"],m=["rgb(60,60,60)","rgb(255,255,255)","rgb(255,255,255)","rgb(255,255,255)"],n=[.8,0,0,.8];void 0===this.shader&&(this.shader={percents:l,colors:m,opacity:n});var o="gradient"+JenScript.sequenceId++;this.gradientIds[this.gradientIds.length]=o;var p=(new JenScript.SVGLinearGradient).Id(o).from(j.x,j.y).to(k.x,k.y).shade(this.shader.percents,this.shader.colors,this.shader.opacity).toSVG();a.definesSVG(p);var q="M"+h.x+","+h.y+" A"+(b.radius-this.offset)+","+(b.radius-this.offset)+" 0 "+f+",0 "+i.x+","+i.y+" L"+e.sc.x+","+e.sc.y+" Z",r=(new JenScript.SVGElement).name("path").attr("fill","url(#"+o+")").attr("d",q).attr("fill-opacity",this.fillOpacity).buildHTML();a.deleteGraphicsElement(b.Id+this.Id+e.Id);var s=(new JenScript.SVGGroup).Id(b.Id+this.Id+e.Id).opacity(e.opacity).toSVG();s.appendChild(r),c.appendChild(s)}b.svg.pieRoot.appendChild(c)}})}(),function(){JenScript.PieAbstractLabel=function(a){this._init(a)},JenScript.Model.inheritPrototype(JenScript.PieAbstractLabel,JenScript.AbstractLabel),JenScript.Model.addMethods(JenScript.PieAbstractLabel,{_init:function(a){JenScript.AbstractLabel.call(this,a)},paintPieSliceLabel:function(){throw new Error("paintPieSliceLabel method should be provide by override")}}),JenScript.PieBorderLabel=function(a){this.__init(a)},JenScript.Model.inheritPrototype(JenScript.PieBorderLabel,JenScript.PieAbstractLabel),JenScript.Model.addMethods(JenScript.PieBorderLabel,{__init:function(a){a=a||{},this.margin=void 0!==a.margin?a.margin:50,this.linkExtends=void 0!==a.linkExtends?a.linkExtends:30,a.name="JenScript.PieBorderLabel",JenScript.PieAbstractLabel.call(this,a)},setMargin:function(a){this.margin=a,this.slice.pie.plugin.repaintPlugin()},setLinkExtends:function(a){this.linkExtends=a,this.slice.pie.plugin.repaintPlugin()},paintPieSliceLabel:function(a,b){var c=b.pie.radius,d=b.medianDegree,e=b.pie.buildCenterX+(c+b.getDivergence())*Math.cos(JenScript.Math.toRadians(d)),f=b.pie.buildCenterY-(c+b.getDivergence())*Math.sin(JenScript.Math.toRadians(d)),g=b.pie.buildCenterX+(c+this.linkExtends+b.getDivergence())*Math.cos(JenScript.Math.toRadians(d)),h=b.pie.buildCenterY-(c+this.linkExtends+b.getDivergence())*Math.sin(JenScript.Math.toRadians(d)),i=0,j=h,k=0,l=h,m="middle";d>=270&&360>=d||d>=0&&90>=d?(i=b.pie.buildCenterX+c+this.margin-5,k=b.pie.buildCenterX+c+this.margin+5,m="start",270===d&&(m="middle"),90===d&&(m="middle")):(i=b.pie.buildCenterX-c-this.margin+5,k=b.pie.buildCenterX-c-this.margin-5,m="end");var n="M "+e+","+f+" Q "+g+","+h+" "+i+","+j,o=(new JenScript.SVGElement).name("path").attr("d",n).attr("fill","none").attr("stroke","darkgray").buildHTML();this.setTextAnchor(m),this.setLocation(new JenScript.Point2D(k,l));var p=void 0!==this.textColor?this.textColor:b.themeColor;this.setTextColor(p),this.setOpacity(b.opacity),this.paintLabel(a),this.svg.label.appendChild(o)}}),JenScript.PieRadialLabel=function(a){this.__init(a)},JenScript.Model.inheritPrototype(JenScript.PieRadialLabel,JenScript.PieAbstractLabel),JenScript.Model.addMethods(JenScript.PieRadialLabel,{__init:function(a){a=a||{},this.offsetRadius=void 0!==a.offsetRadius?a.offsetRadius:20,a.name="JenScript.PieRadialLabel",JenScript.PieAbstractLabel.call(this,a)},setOffsetRadius:function(a){this.offsetRadius=a,this.slice.pie.plugin.repaintPlugin()},paintPieSliceLabel:function(a,b){var c={x:b.sc.x+(b.pie.radius+this.offsetRadius)*Math.cos(JenScript.Math.toRadians(b.medianDegree)),y:b.sc.y-(b.pie.radius+this.offsetRadius)*Math.sin(JenScript.Math.toRadians(b.medianDegree))},d="middle",e=0;b.medianDegree>0&&b.medianDegree<90?(d="start",e=10):b.medianDegree>90&&b.medianDegree<270?(d="end",e=-10):b.medianDegree>270&&b.medianDegree<=360?(d="start",e=10):(90===b.medianDegree||270===b.medianDegree)&&(d="middle"),this.setLocation(new JenScript.Point2D(c.x,c.y)),this.setTextAnchor(d);var f=void 0!==this.textColor?this.textColor:b.themeColor;this.setTextColor(f),this.setOpacity(b.opacity),this.paintLabel(a)}})}(),function(){JenScript.PieBuilder=function(a,b,c){a.registerProjection(b);var d=new JenScript.PiePlugin;b.registerPlugin(d);var e=new JenScript.Pie(c);d.addPie(e);var f=new JenScript.PieDefaultFill;e.setFill(f);var g,h=[],i=[],j=[],k=function(a){var b=new JenScript.PieSlice(a);return g=b,e.addSlice(b),i.push(b),this},l=function(a,b){var c;return"radial"===a&&(c=new JenScript.PieRadialLabel(b)),"border"===a&&(c=new JenScript.PieBorderLabel(b)),g.setSliceLabel(c),h.push(c),this},m=function(a,b){var c;return"linear"===a&&(c=new JenScript.PieLinearEffect(b)),"reflection"===a&&(c=new JenScript.PieReflectionEffect(b)),e.addEffect(c),j.push(c),this},n=function(a){return m("linear",a),this},o=function(a){return m("reflection",a),this};return{slice:k,label:l,effect:m,linearFx:n,reflectFx:o,view:function(){return a},projection:function(){return b},pie:function(){return e},labels:function(){return h},slices:function(){return k},effects:function(){return j}}}}();