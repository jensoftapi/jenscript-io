// JenScript - 1.3.2 2017-06-10
// http://jenscript.io - Copyright 2017 SÃ©bastien Janaud. All Rights reserved


!function(){JenScript.TranslateMode=function(a){this.mode=a.toLowerCase(),this.isTx=function(){return"x"===this.mode||"tx"===this.mode||"translatex"===this.mode},this.isTy=function(){return"y"===this.mode||"ty"===this.mode||"translatey"===this.mode},this.isTxy=function(){return"xy"===this.mode||"txy"===this.mode||"translatexy"===this.mode}},JenScript.TranslatePlugin=function(a){this._init(a)},JenScript.Model.inheritPrototype(JenScript.TranslatePlugin,JenScript.Plugin),JenScript.Model.addMethods(JenScript.TranslatePlugin,{_init:function(a){a=a||{},a.name=void 0!==a.name?a.name:"TranslatePlugin",a.selectable=!0,a.priority=1e3,this.slaves=void 0!==a.slaves?a.slaves:[],this.translateListeners=[],this.lockTranslate=!1,this.translateStartX,this.translateStartY,this.translateCurrentX,this.translateCurrentY,this.translateDx=0,this.translateDy=0,this.mode=new JenScript.TranslateMode(void 0!==a.mode?a.mode:"xy"),JenScript.Plugin.call(this,a),this.semanticX=0,this.semanticY=0,this.shifting=!1},getTranslateDx:function(){return this.translateDx},getTranslateDy:function(){return this.translateDy},isLockTranslate:function(){return this.lockTranslate},isTranslateAuthorized:function(a,b,c,d){return b===JenScript.ViewPart.Device&&this.isLockSelected()&&!this.isLockPassive()&&!this.isWidgetSensible(c,d)},onPress:function(a,b,c,d){a.preventDefault&&a.preventDefault(),this.isTranslateAuthorized(a,b,c,d)&&this.startTranslate(new JenScript.Point2D(c,d))},onRelease:function(a,b,c,d){this.isTranslateAuthorized(a,b,c,d)&&this.stopTranslate(new JenScript.Point2D(c,d))},onExit:function(a,b,c,d){this.stopTranslate(new JenScript.Point2D(c,d))},onMove:function(a,b,c,d){a.preventDefault&&a.preventDefault(),this.isTranslateAuthorized(a,b,c,d)&&this.lockTranslate&&this.boundTranslate(new JenScript.Point2D(c,d))},startTranslate:function(a){this.lockTranslate=!0,this.translateStartX=a.x,this.translateStartY=a.y,this.fireTranslateEvent("start")},stopTranslate:function(a){if(this.isLockTranslate()){var b=this.getProjection(),c=b.getPixelWidth(),d=b.getPixelHeight(),e={x:-this.semanticX,y:d-this.semanticY},f={x:c-this.semanticX,y:-this.semanticY},g=b.pixelToUser(e),h=b.pixelToUser(f);b.bound(g.x,h.x,g.y,h.y);for(var i=0;i<this.slaves.length;i++){var j=this.slaves[i].plugin;j.resetTransform()}this.semanticX=0,this.semanticY=0,this.translateCurrentX=a.x,this.translateCurrentY=a.y,this.lockTranslate=!1,this.fireTranslateEvent("stop")}},addTranslateListener:function(a,b,c){if(void 0===c)throw new Error("Translate listener, listener name should be supplied.");var d={action:a,onEvent:b,name:c};this.translateListeners[this.translateListeners.length]=d},fireTranslateEvent:function(a){for(var b=0;b<this.translateListeners.length;b++){var c=this.translateListeners[b];a===c.action&&c.onEvent(this)}},shift:function(a,b){if(!this.shifting){this.lockPassive=!0,this.shifting=!0;var c=this;void 0===b&&(b={step:5,sleep:5,fraction:20});var d=void 0!==b.step?b.step:5,e=void 0!==b.sleep?b.sleep:5,f=void 0!==b.fraction?b.fraction:20,g=this.getProjection().getPixelHeight()/f,h=this.getProjection().getPixelWidth()/f,i=0,j=0;"North"==a&&(j=g),"South"==a&&(j=-g),"West"==a&&(i=h),"East"==a&&(i=-h);var k=0,l=0,m=function(a,b){setTimeout(function(){k+=i/d,l+=j/d,c.boundTranslate(new JenScript.Point2D(k,l)),b(a)},a*e)};this.startTranslate(new JenScript.Point2D(k,l));for(var n=0;d>=n;n++)m(n,function(a){a===d&&(c.lockPassive=!1,c.shifting=!1,c.stopTranslate(new JenScript.Point2D(k,l)))})}},boundTranslate:function(a){this.translateCurrentX=a.x,this.translateCurrentY=a.y;var b=this.translateCurrentX-this.translateStartX,c=this.translateCurrentY-this.translateStartY;this.mode.isTx()?c=0:this.mode.isTy()&&(b=0),this.processSemanticTranslate(b,c),this.translateStartX=this.translateCurrentX,this.translateStartY=this.translateCurrentY,this.fireTranslateEvent("bound")},processSemanticTranslate:function(a,b){this.translateDx=a,this.translateDy=b,this.semanticX=this.semanticX+a,this.semanticY=this.semanticY+b;for(var c=0;c<this.slaves.length;c++){var d=this.slaves[c].plugin,e=this.slaves[c].direction;"x"===e&&d.translate(d.tx+a,d.ty),"y"===e&&d.translate(d.tx,d.ty+b),"xy"===e&&d.translate(d.tx+a,d.ty+b)}},processGeometricTranslate:function(a,b){this.translateDx=a,this.translateDy=b;var c=this.getProjection();if(void 0!==c){var d=c.getPixelWidth(),e=c.getPixelHeight(),f={x:-a,y:e-b},g={x:d-a,y:-b},h=c.pixelToUser(f),i=c.pixelToUser(g);c.bound(h.x,i.x,h.y,i.y)}},onProjectionRegister:function(){}})}(),function(){JenScript.TranslatePad=function(a){this.___init(a)},JenScript.Model.inheritPrototype(JenScript.TranslatePad,JenScript.AbstractBackwardForwardPadWidget),JenScript.Model.addMethods(JenScript.TranslatePad,{___init:function(a){a=a||{},a.Id="translate_pad"+JenScript.sequenceId++,a.width=64,a.height=64,a.xIndex=60,a.yIndex=100,JenScript.AbstractBackwardForwardPadWidget.call(this,a),this.baseFillColor="black",this.baseStrokeColor="#f39c12",this.baseStrokeWidth=1,this.controlStrokeColor="#2980b9",this.controlStrokeWidth=1,this.buttonFillColor="#2ecc71",this.buttonRolloverFillColor="#f39c12",this.buttonStrokeColor="#8e44ad",this.buttonRolloverStrokeColor="#f39c12",this.buttonStrokeWidth=1},onNorthButtonPress:function(){this.getHost().isLockSelected()&&this.getHost().shift("North")},onSouthButtonPress:function(){this.getHost().isLockSelected()&&this.getHost().shift("South")},onWestButtonPress:function(){this.getHost().isLockSelected()&&this.getHost().shift("West")},onEastButtonPress:function(){this.getHost().isLockSelected()&&this.getHost().shift("East")},onRegister:function(){this.attachPluginLockUnlockFactory("Tranlate Pad widget factory")}})}(),function(){JenScript.TranslateX=function(a){this.___init(a)},JenScript.Model.inheritPrototype(JenScript.TranslateX,JenScript.AbstractBackwardForwardBarWidget),JenScript.Model.addMethods(JenScript.TranslateX,{___init:function(a){a=a||{},a.name="TranslateWidgetX",a.Id="translate_tx"+JenScript.sequenceId++,a.width=void 0!==a.width?a.width:100,a.height=void 0!==a.height?a.height:16,a.xIndex=void 0!==a.xIndex?a.xIndex:2,a.yIndex=void 0!==a.yIndex?a.yIndex:100,a.barOrientation="Horizontal",JenScript.AbstractBackwardForwardBarWidget.call(this,a),this.sample=void 0!==a.sample?a.sample:{step:40,sleep:10,fraction:3},this.setOrphanLock(!0)},onButton1Press:function(){this.getHost().shift("West",this.sample)},onButton2Press:function(){this.getHost().shift("East",this.sample)},onRegister:function(){}})}(),function(){JenScript.TranslateY=function(a){this.___init(a)},JenScript.Model.inheritPrototype(JenScript.TranslateY,JenScript.AbstractBackwardForwardBarWidget),JenScript.Model.addMethods(JenScript.TranslateY,{___init:function(a){a=a||{},a.name="TranslateWidgetY",a.Id="translate_ty"+JenScript.sequenceId++,a.width=void 0!==a.width?a.width:16,a.height=void 0!==a.height?a.height:100,a.xIndex=void 0!==a.xIndex?a.xIndex:100,a.yIndex=void 0!==a.yIndex?a.yIndex:1,a.barOrientation="Vertical",JenScript.AbstractBackwardForwardBarWidget.call(this,a),this.sample=void 0!==a.sample?a.sample:{step:40,sleep:10,fraction:3},this.setOrphanLock(!0)},onButton1Press:function(){this.getHost().shift("North",this.sample)},onButton2Press:function(){this.getHost().shift("South",this.sample)},onRegister:function(){}})}(),function(){JenScript.TranslateCompassWidget=function(a){this._init(a)},JenScript.Model.inheritPrototype(JenScript.TranslateCompassWidget,JenScript.Widget),JenScript.Model.addMethods(JenScript.TranslateCompassWidget,{_init:function(a){a=a||{},a.name="TranslateCompass",this.translateCompassWidgetID="translate_compass"+JenScript.sequenceId++,this.compassSquareSize=void 0!==a.compassSquareSize?a.compassSquareSize:64,this.compassWidget,this.compassStyle="Merge",this.name,this.ringDrawColor="rgba(91,151,168,0.7)",this.ringFillColor=void 0!==a.ringFillColor?a.ringFillColor:"red",this.ringFillOpacity=.5,this.ringDrawOpacity=1,this.ringNeedleDrawColor,this.ringNeedleFillColor,this.averageCounter=0,this.maxAverage=2,this.averageDx=0,this.averageDy=0,this.compassGeometry=new this.CompassGeometry(0,0,this.compassSquareSize/2-10,this.compassSquareSize/2-4),this.needleGeometry=new this.NeedleGeometry,this.needleVector=new this.NeedleVector,a.Id=this.translateCompassWidgetID,a.width=this.compassSquareSize,a.height=this.compassSquareSize,a.xIndex=void 0!==a.xIndex?a.xIndex:100,a.yIndex=void 0!==a.yIndex?a.yIndex:0,JenScript.Widget.call(this,a)},CompassGeometry:function(a,b,c,d){this.centerX=a,this.centerY=b,this.innerRadius=c,this.outerRadius=d,this.builCompass=function(){}},NeedleGeometry:function(){this.theta=0,this.paint="rgba(0, 0, 0, 0.6)",this.colorTheme="white",this.alphaProjection=18},NeedleVector:function(){this.startx=0,this.endx=0,this.starty=0,this.endy=0},onRegister:function(){var a=this;this.getHost().addTranslateListener("start",function(){a.create()},"Translate compass widget translate start listener, create"),this.getHost().addTranslateListener("bound",function(){a.averageCounter<a.maxAverage?(a.averageCounter++,a.averageDx=a.averageDx+a.getHost().getTranslateDx(),a.averageDy=a.averageDy+a.getHost().getTranslateDy()):(a.needleVector.startx=0,a.needleVector.endx=a.averageDx/a.averageCounter,a.needleVector.starty=0,a.needleVector.endy=a.averageDy/a.averageCounter,a.destroy(),a.create(),a.averageCounter=0,a.averageDx=0,a.averageDy=0)},"translate compass widget translate process listener"),this.getHost().addTranslateListener("stop",function(){a.destroy()},"translate compass widget translate stop listener, destroy"),this.attachLayoutFolderFactory("Compass Layout Folder")},getCompassGeometry:function(){return this.compassGeometry},solveCompass:function(){var a=this.getWidgetFolder(),b=a.x+a.width/2,c=a.y+a.height/2;this.getCompassGeometry().centerX=b,this.getCompassGeometry().centerY=c;var d=0,e=this.needleVector.startx,f=this.needleVector.starty,g=this.needleVector.endx,h=this.needleVector.endy;g>e&&f>=h?d=Math.atan((f-h)/(g-e)):g>e&&h>f?d=Math.atan((f-h)/(g-e))+2*Math.PI:e>g?d=Math.atan((f-h)/(g-e))+Math.PI:g==e&&f>h?d=Math.PI/2:g==e&&h>f&&(d=3*Math.PI/2),this.needleGeometry.theta=JenScript.Math.toDegrees(d)},paintTranslateCompass:function(a){var b=this.getWidgetFolder();if(void 0!==b){this.solveCompass();var c=this.compassGeometry,d=this.needleGeometry,e=(new JenScript.SVGPath).moveTo(c.centerX-c.outerRadius,c.centerY).arcTo(c.outerRadius,c.outerRadius,0,1,1,c.centerX+c.outerRadius,c.centerY).arcTo(c.outerRadius,c.outerRadius,0,1,1,c.centerX-c.outerRadius,c.centerY).moveTo(c.centerX-c.innerRadius,c.centerY).arcTo(c.innerRadius,c.innerRadius,0,1,1,c.centerX+c.innerRadius,c.centerY).arcTo(c.innerRadius,c.innerRadius,0,1,1,c.centerX-c.innerRadius,c.centerY).attr("fill-rule","evenodd").strokeNone().fill(this.ringFillColor).fillOpacity(this.ringFillOpacity).close(),f=2,g=8,h=18,i=d.theta,j=(c.outerRadius+g)*Math.cos(JenScript.Math.toRadians(i)),k=(c.outerRadius+g)*Math.sin(JenScript.Math.toRadians(i)),l=(c.innerRadius+f)*Math.cos(JenScript.Math.toRadians(i-h)),m=(c.innerRadius+f)*Math.sin(JenScript.Math.toRadians(i-h)),n=(c.innerRadius+f)*Math.cos(JenScript.Math.toRadians(i+h)),o=(c.innerRadius+f)*Math.sin(JenScript.Math.toRadians(i+h)),p=(new JenScript.SVGPath).moveTo(c.centerX+j,c.centerY-k).lineTo(c.centerX+n,c.centerY-o).lineTo(c.centerX+l,c.centerY-m).strokeNone().fill(this.ringFillColor).strokeOpacity(this.ringDrawOpacity).close(),q=(new JenScript.SVGGroup).Id(this.Id);a.deleteGraphicsElement(this.Id),q.child(e.toSVG()).child(p.toSVG()),a.insertSVG(q.toSVG())}},paintWidget:function(a){void 0!==this.getHost()&&this.getHost().isLockTranslate()&&this.paintTranslateCompass(a)}})}(),function(){JenScript.TranslateSynchronizer=function(a){this.init(a)},JenScript.Model.addMethods(JenScript.TranslateSynchronizer,{init:function(a){this.translateList=[],this.dispathingEvent=!1;var b=a.translates;if(!this.dispathingEvent){this.dispathingEvent=!0;for(var c=0;c<b.length;c++){var d=this;b[c].addTranslateListener("start",function(a){d.translateStarted(a)}," Translate synchronizer, start listener"),b[c].addTranslateListener("bound",function(a){d.bound(a)}," Translate synchronizer, bound listener"),b[c].addTranslateListener("stop",function(a){d.translateStoped(a)}," Translate synchronizer, stop listener"),b[c].addPluginListener("lock",function(a){d.pluginSelected(a)},"Translate Synchronizer plugin lock listener"),b[c].addPluginListener("unlock",function(a){d.pluginUnlockSelected(a)},"Translate Synchronizer plugin unlock listener"),b[c].addPluginListener("passive",function(a){d.pluginPassive(a)},"Translate Synchronizer plugin passive listener"),b[c].addPluginListener("unpassive",function(a){d.pluginUnpassive(a)},"Translate Synchronizer plugin unpassive listener"),this.translateList[this.translateList.length]=b[c]}this.dispathingEvent=!1}},pluginPassive:function(a){if(!this.dispathingEvent){this.dispathingEvent=!0;for(var b=0;b<this.translateList.length;b++){var c=this.translateList[b];c.Id!==a.Id&&c.passive()}this.dispathingEvent=!1}},pluginUnpassive:function(a){if(!this.dispathingEvent){this.dispathingEvent=!0;for(var b=0;b<this.translateList.length;b++){var c=this.translateList[b];c.Id!==a.Id&&c.unpassive()}this.dispathingEvent=!1}},pluginSelected:function(a){if(!this.dispathingEvent){this.dispathingEvent=!0;for(var b=0;b<this.translateList.length;b++){var c=this.translateList[b];c.Id!==a.Id&&c.select()}this.dispathingEvent=!1}},pluginUnlockSelected:function(a){if(!this.dispathingEvent){this.dispathingEvent=!0;for(var b=0;b<this.translateList.length;b++){var c=this.translateList[b];c.Id!==a.Id&&c.unselect()}this.dispathingEvent=!1}},translateL2RChanged:function(){},translateB2TChanged:function(){},translateStarted:function(a){if(!this.dispathingEvent){this.dispathingEvent=!0;for(var b=0;b<this.translateList.length;b++){var c=this.translateList[b];c.Id!==a.Id&&c.startTranslate(new JenScript.Point2D(a.translateStartX,a.translateStartY))}this.dispathingEvent=!1}},bound:function(a){if(!this.dispathingEvent){this.dispathingEvent=!0;for(var b=0;b<this.translateList.length;b++){var c=this.translateList[b];c.Id!==a.Id&&c.boundTranslate(new JenScript.Point2D(a.translateCurrentX,a.translateCurrentY))}this.dispathingEvent=!1}},translateStoped:function(a){if(!this.dispathingEvent){this.dispathingEvent=!0;for(var b=0;b<this.translateList.length;b++){var c=this.translateList[b];c.Id!==a.Id&&c.stopTranslate(new JenScript.Point2D(a.translateCurrentX,a.translateCurrentY))}this.dispathingEvent=!1}}})}();
//# sourceMappingURL=jenscript-translate.min.js.map