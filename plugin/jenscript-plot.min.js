// JenScript -  JavaScript HTML5/SVG Library
// version : 1.2.0
// Author : Sebastien Janaud 
// Web Site : http://jenscript.io
// Twitter  : http://twitter.com/JenSoftAPI
// Copyright (C) 2008 - 2017 JenScript, product by JenSoftAPI company, France.
// build: 2017-05-25
// All Rights reserved

!function(){JenScript.PlotPlugin=function(a){this._init(a)},JenScript.Model.inheritPrototype(JenScript.PlotPlugin,JenScript.Plugin),JenScript.Model.addMethods(JenScript.PlotPlugin,{_init:function(a){a=a||{},a.priority=100,a.name="PlotPlugin",JenScript.Plugin.call(this,a),this.plots=[]},addPlot:function(a){a.plugin=this,this.plots[this.plots.length]=a,this.repaintPlugin()},removePlot:function(a){for(var b=[],c=0;c<this.plots.length;c++)this.plots[c].equals(a)||(b[b.length]=this.plots[c]);this.plots=b},onProjectionRegister:function(){var a=this;this.getProjection().addProjectionListener("boundChanged",function(){a.repaintPlugin()},"PlotPlugin projection bound changed")},paintPlugin:function(a,b){if("Device"===b)for(var c=0;c<this.plots.length;c++){var d=this.plots[c];d.solvePlot();for(var e=d.devicePoints,f=(new JenScript.SVGPath).Id(d.Id),c=0;c<e.length;c++){var g=e[c];0===c?f.moveTo(g.x,g.y):f.lineTo(g.x,g.y)}a.deleteGraphicsElement(d.Id),a.insertSVG(f.fillNone().stroke(d.plotColor).strokeWidth(d.plotWidth).toSVG())}}})}(),function(){JenScript.Plot=function(a){this.init(a)},JenScript.Model.addMethods(JenScript.Plot,{init:function(a){this.Id="plot"+JenScript.sequenceId++,this.userPoints=[],this.devicePoints=[],this.anchorsPoints=[],this.plugin,this.plotColor=void 0!==a.plotColor?a.plotColor:"red",this.plotWidth=void 0!==a.plotWidth?a.plotWidth:2},addPoint:function(a,b){this.userPoints[this.userPoints.length]=new JenScript.Point2D(a,b)},getPoints:function(){return this.userPoints},solvePlot:function(){throw new Error("SolvePlot should be provided")}})}(),function(){JenScript.LinePlot=function(a){this._init(a)},JenScript.Model.inheritPrototype(JenScript.LinePlot,JenScript.Plot),JenScript.Model.addMethods(JenScript.LinePlot,{_init:function(a){a=a||{},JenScript.Plot.call(this,a)},solvePlot:function(){for(var a=[],b=0;b<this.getPoints().length;b++){var c=this.plugin.getProjection().userToPixel(this.getPoints()[b]);a[a.length]=c}this.devicePoints=a}})}(),function(){JenScript.BezierPlot=function(a){this._init(a)},JenScript.Model.inheritPrototype(JenScript.BezierPlot,JenScript.Plot),JenScript.Model.addMethods(JenScript.BezierPlot,{_init:function(a){a=a||{},this.STEPS=void 0!==a.step?a.step:12,JenScript.Plot.call(this,a)},b:function(a,b){switch(a){case 0:return(1-b)*(1-b)*(1-b);case 1:return 3*b*(1-b)*(1-b);case 2:return 3*b*b*(1-b);case 3:return b*b*b}return 0},p:function(a,b){for(var c=0,d=0,e=0;3>=e;e++)c+=this.b(e,b)*this.getPoints()[a+e].getX(),d+=this.b(e,b)*this.getPoints()[a+e].getY();return new JenScript.Point2D(c,d)},solvePlot:function(){var a=[],b=this.p(0,0),c=this.plugin.getProjection().userToPixel(b);a[0]=c;for(var d=0;d<this.getPoints().length-3;d+=3)for(var e=1;e<=this.STEPS;e++)b=this.p(d,e/this.STEPS),c=this.plugin.getProjection().userToPixel(b),a[a.length]=c;this.devicePoints=a}})}(),function(){JenScript.BezierG1Plot=function(a){this.__init(a)},JenScript.Model.inheritPrototype(JenScript.BezierG1Plot,JenScript.BezierPlot),JenScript.Model.addMethods(JenScript.BezierG1Plot,{__init:function(a){a=a||{},JenScript.BezierPlot.call(this,a)},forceCollinear:function(a,b,c){var d=function(a,b,c,d){return Math.sqrt((a-c)*(a-c)+(b-d)*(b-d))},e=d(this.userPoints[a].getX(),this.userPoints[a].getY(),this.userPoints[b].getX(),this.userPoints[b].getY()),f=d(this.userPoints[b].getX(),this.userPoints[b].getY(),this.userPoints[c].getX(),this.userPoints[c].getY()),g=f/e,h=this.userPoints[b].getX()+g*(this.userPoints[b].getX()-this.userPoints[a].getX()),i=this.userPoints[b].getY()+g*(this.userPoints[b].getY()-this.userPoints[a].getY());this.userPoints[c]=new JenScript.Point2D(h,i)},addPoint:function(a,b){this.userPoints[this.userPoints.length]=new JenScript.Point2D(a,b);var c=this.userPoints.length-1;c%3==1&&c>1&&this.forceCollinear(c,c-1,c-2)}})}(),function(){JenScript.BSplinePlot=function(a){this._init(a)},JenScript.Model.inheritPrototype(JenScript.BSplinePlot,JenScript.Plot),JenScript.Model.addMethods(JenScript.BSplinePlot,{_init:function(a){a=a||{},this.STEPS=void 0!==a.step?a.step:12,JenScript.Plot.call(this,a)},b:function(a,b){switch(a){case-2:return(((-b+3)*b-3)*b+1)/6;case-1:return((3*b-6)*b*b+4)/6;case 0:return(((-3*b+3)*b+3)*b+1)/6;case 1:return b*b*b/6}return 0},p:function(a,b){for(var c=0,d=0,e=-2;1>=e;e++)c+=this.b(e,b)*this.getPoints()[a+e].getX(),d+=this.b(e,b)*this.getPoints()[a+e].getY();return new JenScript.Point2D(Math.round(c),Math.round(d))},solvePlot:function(){var a=[],b=this.p(2,0),c=this.plugin.getProjection().userToPixel(b);a[0]=c;for(var d=2;d<this.getPoints().length-1;d++)for(var e=1;e<=this.STEPS;e++)b=this.p(d,e/this.STEPS),c=this.plugin.getProjection().userToPixel(b),a[a.length]=c;this.devicePoints=a}})}(),function(){JenScript.PlotCubic=function(a,b,c,d){this.a=a,this.b=b,this.c=c,this.d=d,this.eval=function(a){return((this.d*a+this.c)*a+this.b)*a+this.a}},JenScript.NaturalCubicPlot=function(a){this._init(a)},JenScript.Model.inheritPrototype(JenScript.NaturalCubicPlot,JenScript.Plot),JenScript.Model.addMethods(JenScript.NaturalCubicPlot,{_init:function(a){a=a||{},this.STEPS=void 0!==a.step?a.step:12,JenScript.Plot.call(this,a)},calcNaturalCubic:function(a,b){var c=[],d=[],e=[];c[0]=.5;for(var f=1;a>f;f++)c[f]=1/(4-c[f-1]);c[a]=1/(2-c[a-1]),d[0]=3*(b[1]-b[0])*c[0];for(var f=1;a>f;f++)d[f]=(3*(b[f+1]-b[f-1])-d[f-1])*c[f];d[a]=(3*(b[a]-b[a-1])-d[a-1])*c[a],e[a]=d[a];for(var f=a-1;f>=0;f--)e[f]=d[f]-c[f]*e[f+1];var g=[];for(f=0;a>f;f++)g[f]=new JenScript.PlotCubic(b[f],e[f],3*(b[f+1]-b[f])-2*e[f]-e[f+1],2*(b[f]-b[f+1])+e[f]+e[f+1]);return g},solvePlot:function(){var a=[];if(this.userPoints.length>=2){for(var b=[],c=[],d=0;d<this.userPoints.length;d++)b[d]=this.userPoints[d].x,c[d]=this.userPoints[d].y;var e=this.calcNaturalCubic(this.userPoints.length-1,b),f=this.calcNaturalCubic(this.userPoints.length-1,c),g=new JenScript.Point2D(Math.round(e[0].eval(0)),Math.round(f[0].eval(0))),h=this.plugin.getProjection().userToPixel(g);a[0]=h;for(var i=0;i<e.length;i++)for(var j=1;j<=this.STEPS;j++){var k=j/this.STEPS,l=new JenScript.Point2D(Math.round(e[i].eval(k)),Math.round(f[i].eval(k))),m=this.plugin.getProjection().userToPixel(l);a[a.length]=m}}this.devicePoints=a}})}(),function(){JenScript.NaturalClosedCubicPlot=function(a){this.__init(a)},JenScript.Model.inheritPrototype(JenScript.NaturalClosedCubicPlot,JenScript.NaturalCubicPlot),JenScript.Model.addMethods(JenScript.NaturalClosedCubicPlot,{__init:function(a){a=a||{},JenScript.NaturalCubicPlot.call(this,a)},calcNaturalCubic:function(a,b){var c,d,e,f,g=[],h=[],i=[],j=[];g[1]=h[1]=c=.25,i[0]=3*c*(b[1]-b[a]),f=4,d=3*(b[0]-b[a-1]),e=1;for(var k=1;a>k;k++)h[k+1]=c=1/(4-h[k]),g[k+1]=-c*g[k],i[k]=c*(3*(b[k+1]-b[k-1])-i[k-1]),f-=e*g[k],d-=e*i[k-1],e=-h[k]*e;f-=(e+1)*(h[a]+g[a]),i[a]=d-(e+1)*i[a-1],j[a]=i[a]/f,j[a-1]=i[a-1]-(h[a]+g[a])*j[a];for(var k=a-2;k>=0;k--)j[k]=i[k]-h[k+1]*j[k+1]-g[k+1]*j[a];for(var l=[],k=0;a>k;k++)l[k]=new JenScript.PlotCubic(b[k],j[k],3*(b[k+1]-b[k])-2*j[k]-j[k+1],2*(b[k]-b[k+1])+j[k]+j[k+1]);return l[a]=new JenScript.PlotCubic(b[a],j[a],3*(b[0]-b[a])-2*j[a]-j[0],2*(b[a]-b[0])+j[a]+j[0]),l}})}(),function(){JenScript.CatmullRomPlot=function(a){this.__init(a)},JenScript.Model.inheritPrototype(JenScript.CatmullRomPlot,JenScript.BSplinePlot),JenScript.Model.addMethods(JenScript.CatmullRomPlot,{__init:function(a){a=a||{},JenScript.BSplinePlot.call(this,a)},b:function(a,b){switch(a){case-2:return((-b+2)*b-1)*b/2;case-1:return((3*b-5)*b*b+2)/2;case 0:return((-3*b+4)*b+1)*b/2;case 1:return(b-1)*b*b/2}return 0}})}();