// JenScript -  JavaScript HTML5/SVG Library
// version : 1.3.1
// Author : Sebastien Janaud 
// Web Site : http://jenscript.io
// Twitter  : http://twitter.com/JenSoftAPI
// Copyright (C) 2008 - 2017 JenScript, product by JenSoftAPI company, France.
// build: 2017-06-02
// All Rights reserved

!function(){JenScript.Tooltip=function(a){this.init(a)},JenScript.Model.addMethods(JenScript.Tooltip,{init:function(a){a=a||{},this.Id=void 0!==a.Id?a.Id:"Tooltip"+JenScript.sequenceId++,this.opacity=void 0!==a.opacity?a.opacity:1,this.name=void 0!==a.name?a.name:"Anonymous Tooltip",this.visible=void 0!==a.visible?a.visible:!0,this.width=void 0!==a.width?a.width:200,this.text=void 0!==a.text?a.text:"Tooltip",this.textColor=a.textColor,this.fontSize=void 0!==a.fontSize?a.fontSize:12,this.paintType=void 0!==a.paintType?a.paintType:"Both",this.cornerRadius=void 0!==a.cornerRadius?a.cornerRadius:0,this.outlineWidth=void 0!==a.outlineWidth?a.outlineWidth:1,this.shader=a.shader,this.outlineColor=a.outlineColor,this.fillColor=a.fillColor,this.fillOpacity=void 0!==a.fillOpacity?a.fillOpacity:1,this.deltaOn=void 0!==a.deltaOn?a.deltaOn:4,this.deltaOut=void 0!==a.deltaOut?a.deltaOut:12,this.padding=10,this.arrowAnchor=a.arrowAnchor,this.position=a.position,this.lengthRatio=void 0!==a.lengthRatio?a.lengthRatio:.5},equals:function(a){return void 0===a?!1:void 0===a.Id?!1:a.Id===this.Id},setText:function(a){this.text=a},getText:function(){return this.text},setArrowAnchor:function(a){this.arrowAnchor=a},getArrowAnchor:function(){return this.arrowAnchor},setVisible:function(a){this.visible=a},isVisible:function(){return this.visible},setX:function(a){this.location.x=a},setY:function(a){this.location.y=a},getX:function(){return this.location.x},getY:function(){return this.location.y},setLocation:function(a){this.location=a},setLocation:function(a){this.location=a},getLocation:function(){return this.location},setTextColor:function(a){this.textColor=a},getTextColor:function(){return this.textColor},setFontSize:function(a){this.fontSize=a},getFontSize:function(){return this.fontSize},setShader:function(a){this.shader=a},getShader:function(){return this.shader},setOutlineColor:function(a){this.outlineColor=a},getOutlineColor:function(){return this.outlineColor},setOutlineWidth:function(a){this.outlineWidth=a},getOutlineWidth:function(){return this.outlineWidth},setFillColor:function(a){this.fillColor=a},getFillColor:function(){return this.fillColor},setOpacity:function(a){this.opacity=a},getOpacity:function(){return this.opacity},textLayout:function(a,b,c,d,e,f){for(var g=new Array,h=!0,j=0,k=0;1==h;){var l=a.indexOf("-",j);-1==l?h=!1:(g.push(l),j=l+1)}var m,n,o=a.split(/[\s-]/),p="",q=0,r=0,s=0;for(i=0;i<o.length;i++){var t=o[i];if(r+=t.length+1,s>c||0==i){if(s>c){var u=n.firstChild.nodeValue;if(u=u.slice(0,u.length-o[i-1].length-2),n.firstChild.nodeValue=u,f){var v=u.split(/\s/).length;s=n.getComputedTextLength();var w=(c-s)/(v-1);n.setAttributeNS(null,"word-spacing",w)}}n=document.createElementNS(JenScript.SVG_NS,"tspan"),n.setAttributeNS(null,"x",d),n.setAttributeNS(null,"dy",q),m=document.createTextNode(p),n.appendChild(m),b.appendChild(n),p=this.isDash(g,r-1)?t+"-":t+" ",0!=i&&(p=o[i-1]+" "+p),q=e,k+=q}else p+=this.isDash(g,r-1)?t+"-":t+" ";if(n.firstChild.nodeValue=p,s=n.getComputedTextLength(),i==o.length-1&&s>c){var u=n.firstChild.nodeValue;n.firstChild.nodeValue=u.slice(0,u.length-o[i].length-1),n=document.createElementNS(JenScript.SVG_NS,"tspan"),n.setAttributeNS(null,"x",d),n.setAttributeNS(null,"dy",q),m=document.createTextNode(o[i]),n.appendChild(m),b.appendChild(n)}}return k},isDash:function(a,b){for(var c=!1,d=0;d<a.length;d++)a[d]==b&&(c=!0);return c},paintTooltip:function(a){if(!this.isVisible())return void a.deleteGraphicsElement(this.Id);if(void 0===this.arrowAnchor)throw Error("Arrow Anchor should be supplied.");var b=(new JenScript.SVGGroup).Id(this.Id).toSVG();a.insertSVG(b);var c=(new JenScript.SVGText).Id(this.Id).location(0,0).fill(this.textColor).fontSize(this.fontSize).textAnchor("start").toSVG();b.appendChild(c);var d,e,f=(this.textLayout(this.text,c,this.width,0,this.fontSize,!0),c.getBBox());if("bottom"===this.position)d=this.arrowAnchor.x-(f.width+2*this.padding)*this.lengthRatio+this.padding,e=this.arrowAnchor.y+this.deltaOut+this.padding+this.fontSize,c.setAttribute("transform","translate("+d+","+e+")");else if("top"===this.position)d=this.arrowAnchor.x-(f.width+2*this.padding)*this.lengthRatio+this.padding,e=this.arrowAnchor.y-this.deltaOut-f.height+this.fontSize-this.padding,c.setAttribute("transform","translate("+d+","+e+")");else if("left"===this.position)d=this.arrowAnchor.x-this.deltaOut-(f.width+2*this.padding)+this.padding,e=this.arrowAnchor.y-(f.height+2*this.padding)*this.lengthRatio+this.fontSize+this.padding,c.setAttribute("transform","translate("+d+","+e+")");else{if("right"!==this.position)throw Error("Tooltip bad position : "+this.position);d=this.arrowAnchor.x+this.deltaOut+1*this.padding,e=this.arrowAnchor.y-(f.height+2*this.padding)*this.lengthRatio+this.fontSize+this.padding,c.setAttribute("transform","translate("+d+","+e+")")}if("None"!==this.paintType){var g={x:f.x-this.padding+d,y:f.y-this.padding+e,width:f.width+2*this.padding,height:f.height+2*this.padding},h=this.getPath(g,a);if(h.attr("stroke-linejoin","round"),h.attr("stroke-linecap","round"),"Fill"===this.paintType||"Both"===this.paintType)if(void 0!==this.fillColor)h.fill(this.fillColor).fillOpacity(this.fillOpacity);else if(void 0!==this.shader&&void 0!==this.shader.percents&&void 0!==this.shader.colors){var i=(new JenScript.SVGLinearGradient).Id(this.Id+"gradient").from(f.x,f.y-2).to(f.x,f.y+4+f.height).shade(this.getShader().percents,this.getShader().colors,this.getShader().opacity).fillOpacity(this.fillOpacity).toSVG();a.deleteGraphicsElement(this.Id+"gradient"),a.definesSVG(i),h.fillURL(this.Id+"gradient")}("Stroke"===this.paintType||"Both"===this.paintType)&&void 0!==this.getOutlineColor()&&h.stroke(this.getOutlineColor()).strokeWidth(this.outlineWidth);var j=h.toSVG();c.parentNode.insertBefore(j,c)}},getPath:function(a){var b,c=[{x:a.x,y:a.y},{x:a.x+a.width,y:a.y},{x:a.x+a.width,y:a.y+a.height},{x:a.x,y:a.y+a.height}];if("top"===this.position){var d={x:a.x+a.width*this.lengthRatio,y:a.y+a.height};b=[{x:d.x+this.deltaOn,y:d.y},{x:d.x,y:d.y+this.deltaOut},{x:d.x-this.deltaOn,y:d.y}],c.splice.apply(c,[3,0].concat(b))}if("bottom"===this.position){var d={x:a.x+a.width*this.lengthRatio,y:a.y};b=[{x:d.x-this.deltaOn,y:d.y},{x:d.x,y:d.y-this.deltaOut},{x:d.x+this.deltaOn,y:d.y}],c.splice.apply(c,[1,0].concat(b))}if("left"===this.position){var d={x:a.x+a.width,y:a.y+a.height*this.lengthRatio};b=[{x:d.x,y:d.y-this.deltaOn},{x:d.x+this.deltaOut,y:d.y},{x:d.x,y:d.y+this.deltaOn}],c.splice.apply(c,[2,0].concat(b))}if("right"===this.position){var d={x:a.x,y:a.y+a.height*this.lengthRatio};b=[{x:d.x,y:d.y+this.deltaOn},{x:d.x-this.deltaOut,y:d.y},{x:d.x,y:d.y-this.deltaOn}],c.splice.apply(c,[4,0].concat(b))}var e=new JenScript.SVGPath;e.moveTo(c[0].x,c[0].y);for(var f=1;f<c.length;f++)e.lineTo(c[f].x,c[f].y);return e.close(),e}})}(),function(){JenScript.TooltipPlugin=function(a){this._init(a)},JenScript.Model.inheritPrototype(JenScript.TooltipPlugin,JenScript.Plugin),JenScript.Model.addMethods(JenScript.TooltipPlugin,{_init:function(a){a=a||{},a.name="TooltipPlugin",this.tooltip=a.tooltip,JenScript.Plugin.call(this,a)},paintPlugin:function(a,b){b===JenScript.ViewPart.Device&&this.tooltip.paintTooltip(a)}})}();