// JenScript -  JavaScript HTML5/SVG Library
// version : 1.3.1
// Author : Sebastien Janaud 
// Web Site : http://jenscript.io
// Twitter  : http://twitter.com/JenSoftAPI
// Copyright (C) 2008 - 2017 JenScript, product by JenSoftAPI company, France.
// build: 2017-06-03
// All Rights reserved

!function(){JenScript.Donut3DPlugin=function(a){a=a||{},a.name="Donut3DPlugin",this.donuts=[],JenScript.Plugin.call(this,a)},JenScript.Model.inheritPrototype(JenScript.Donut3DPlugin,JenScript.Plugin),JenScript.Model.addMethods(JenScript.Donut3DPlugin,{addDonut:function(a){a.plugin=this,this.donuts[this.donuts.length]=a,this.repaintPlugin()},onProjectionRegister:function(){var a=this;this.getProjection().addProjectionListener("boundChanged",function(){a.repaintPlugin()},"donut3D projection bound changed")},repaintDonuts:function(){this.repaintPlugin()},paintPlugin:function(a,b){if(b===JenScript.ViewPart.Device)for(var c=0;c<this.donuts.length;c++){var d=this.donuts[c];if(d.isSolvable()){d.solveDonut3D(),a.deleteGraphicsElement(d.Id),d.svg.donutRoot=(new JenScript.SVGGroup).Id(d.Id).toSVG(),a.insertSVG(d.svg.donutRoot),d.donut3DPaint.paintDonut3D(a,d);for(var c=0;c<d.effects.length;c++){var e=d.effects[c];e.effectDonut3D(a,d)}for(var f=0;f<d.slices.length;f++)for(var g=d.slices[f],h=g.getSliceLabels(),i=0;i<h.length;i++)h[i].paintDonut3DSliceLabel(a,g)}}}})}(),function(){JenScript.Donut3D=function(a){this.init(a)},JenScript.Model.addMethods(JenScript.Donut3D,{init:function(a){a=a||{},this.Id="donut3d"+JenScript.sequenceId++,this.name=void 0!==a.name?a.name:"donut3D"+JenScript.sequenceId++,this.innerRadius=void 0!==a.innerRadius?a.innerRadius:60,this.outerRadius=void 0!==a.outerRadius?a.outerRadius:120,this.thickness=void 0!==a.thickness?a.thickness:50,this.tilt=void 0!==a.tilt?a.tilt:40,this.startAngleDegree=void 0!==a.startAngleDegree?a.startAngleDegree:40,this.centerX=void 0!==a.centerX?a.centerX:0,this.centerY=void 0!==a.centerY?a.centerY:0,this.nature=void 0!==a.nature?a.nature:"User",this.projectionThickness,this.outerA,this.outerB,this.innerA,this.innerB,this.donut3DPaint=new JenScript.Donut3DDefaultPaint,this.plugin,this.slices=[],this.effects=[],this.svg={}},setInnerRadius:function(a){this.innerRadius=a},setOuterRadius:function(a){this.outerRadius=a},setThickness:function(a){this.thickness=a},setTilt:function(a){this.tilt=a},setStartAngleDegree:function(a){this.startAngleDegree=a},setCenterX:function(a){this.centerX=a},setCenterY:function(a){this.centerY=a},setCenter:function(a,b){this.centerX=a,this.centerY=b},setNature:function(a){this.nature=a},addEffect:function(a){this.effects[this.effects.length]=a,this.plugin.repaintPlugin()},shift:function(){function a(a){setTimeout(function(){b.startAngleDegree=b.startAngleDegree+36,b.plugin.repaint()},100*a)}for(var b=this,c=0;10>c;c++)a(c)},shift:function(a,b,c){function d(a){setTimeout(function(){g.startAngleDegree=g.startAngleDegree+f>360?g.startAngleDegree+f-360:g.startAngleDegree+f<0?g.startAngleDegree+f+360:g.startAngleDegree+f,g.plugin.repaintDonuts()},a*e)}for(var e=b/c,f=a/c,g=this,h=0;c>h;h++)d(h)},addSlice:function(a){return a.donut=this,this.slices[this.slices.length]=a,this.plugin.repaintDonuts(),this},slice:function(a){var b=new JenScript.Donut3DSlice(a);return this.addSlice(b),this},addSlices:function(a){for(var b=0;b<a.length;b++)this.addSlice(a[b]);return this},getTopFace:function(){for(var a="",b=0;b<this.slices.length;b++)for(var c=this.slices[b],d=0;d<c.fragments.length;d++){var e=c.fragments[d];a+=e.topFace}return a},isSolvable:function(){return this.slices.length>0},solveDonut3D:function(){if(this.tilt<0||this.tilt>90)throw new Error("donut 3D tilt out of range[0,90]");var a=this;!function(){if(a.startAngleDegree>0){if(a.startAngleDegree>=360)for(;a.startAngleDegree>=360;)a.startAngleDegree=a.startAngleDegree-360}else for(;a.startAngleDegree>=0;)a.startAngleDegree=a.startAngleDegree+360}(),function(){var b=a.thickness/90;a.projectionThickness=b*(90-a.tilt)}(),function(){var b=a.outerRadius/90,c=a.innerRadius/90;a.outerA=a.outerRadius,a.outerB=b*a.tilt,a.innerA=a.innerRadius,a.innerB=c*a.tilt}(),function(){for(var b=0,c=0;c<a.slices.length;c++)b+=a.slices[c].value;for(var c=0;c<a.slices.length;c++){var d=a.slices[c].value/b;a.slices[c].normalizedValue=d}}();for(var b=this.startAngleDegree,c=0;c<this.slices.length;c++)this.solveSliceFragments(this.slices[c],b),b=this.slices[c].endAngleDegree,b>360&&(b-=360)},solveSliceFragments:function(a,b){a.clearFragments(),a.painted=!1;var c=b,d=360*a.normalizedValue;a.startAngleDegree=c,a.endAngleDegree=c+d;var e=c+d/2;e>360&&(e-=360),a.medianDegree=e;var f=this.getDonutCenter(),g=f.x+a.divergence*Math.cos(JenScript.Math.toRadians(e)),h=f.y-a.divergence*Math.sin(JenScript.Math.toRadians(e));a.sc={x:g,y:h};for(var i=c,j=d,k=d;k>0;){j=this.getFragmentExtendsDegree(c,d,i,k);var l=this.createSliceFragment(a,i,j);a.addFragment(l),k-=j,i+=j,i>=360&&(i-=360)}},getFragmentExtendsDegree:function(a,b,c,d){if(c>=0&&180>c){var e=180-c;return d>=e?e:d}if(c>=180&&360>c){var e=360-c;return d>=e?e:d}return 0},getDonutCenter:function(){return"User"===this.nature?this.plugin.getProjection().userToPixel({x:this.centerX,y:this.centerY}):"Device"==this.nature?{x:this.centerX,y:this.centerY}:void 0},createSliceFragment:function(a,b,c){var d=new JenScript.Donut3DSlice({name:a.name+".part",value:1,themeColor:a.themeColor});d.fragment=!0,d.parentSlice=a,b>=0&&180>b?(d.type="Back",d.name=d.name+".back"):b>=180&&360>b&&(d.type="Front",d.name=d.name+".front");var e=this.getDonutCenter(),f=a.divergence/90,g=f*this.tilt,h=a.divergence,i=g,j=e.x+h*Math.cos(JenScript.Math.toRadians(a.startAngleDegree+Math.abs(a.endAngleDegree-a.startAngleDegree)/2)),k=e.y-i*Math.sin(JenScript.Math.toRadians(a.startAngleDegree+Math.abs(a.endAngleDegree-a.startAngleDegree)/2)),l={x:j+this.outerA*Math.cos(JenScript.Math.toRadians(b)),y:k-this.outerB*Math.sin(JenScript.Math.toRadians(b))},m={x:j+this.outerA*Math.cos(JenScript.Math.toRadians(b+c)),y:k-this.outerB*Math.sin(JenScript.Math.toRadians(b+c))};d.sos=l,d.soe=m;var n=c>180?"1":"0",o="M"+l.x+","+l.y+" A"+this.outerA+","+this.outerB+" 0 "+n+",0 "+m.x+","+m.y,p="M"+l.x+","+(l.y+this.projectionThickness)+" A"+this.outerA+","+this.outerB+" 0 "+n+",0 "+m.x+","+(m.y+this.projectionThickness);d.outerArcTop=o,d.outerArcBottom=p;var q={x:j+this.innerA*Math.cos(JenScript.Math.toRadians(b)),y:k-this.innerB*Math.sin(JenScript.Math.toRadians(b))},r={x:j+this.innerA*Math.cos(JenScript.Math.toRadians(b+c)),y:k-this.innerB*Math.sin(JenScript.Math.toRadians(b+c))};d.sis=q,d.sie=r;var s="M"+q.x+","+q.y+" A"+this.innerA+","+this.innerB+" 0 "+n+",0 "+r.x+","+r.y,t="M"+q.x+","+(q.y+this.projectionThickness)+" A"+this.innerA+","+this.innerB+" 0 "+n+",0 "+r.x+","+(r.y+this.projectionThickness);d.innerArcTop=s,d.innerArcBottom=t;var u="M"+l.x+","+l.y+" A"+this.outerA+","+this.outerB+" 0 "+n+",0 "+m.x+","+m.y+" L "+r.x+","+r.y+" A"+this.innerA+","+this.innerB+" 0 "+n+",1 "+q.x+","+q.y+" Z";d.topFace=u;var v="M"+l.x+","+(l.y+this.projectionThickness)+" A"+this.outerA+","+this.outerB+" 0 "+n+",0 "+m.x+","+(m.y+this.projectionThickness)+" L "+r.x+","+(r.y+this.projectionThickness)+" A"+this.innerA+","+this.innerB+" 0 "+n+",1 "+q.x+","+(q.y+this.projectionThickness)+" Z";return d.bottomFace=v,d.startFace="M "+l.x+","+l.y+" L "+q.x+","+q.y+" L "+q.x+","+(q.y+this.projectionThickness)+" L "+l.x+","+(l.y+this.projectionThickness)+" Z",d.endFace="M "+m.x+","+m.y+" L "+r.x+","+r.y+" L "+r.x+","+(r.y+this.projectionThickness)+" L "+m.x+","+(m.y+this.projectionThickness)+" Z",d.innerFace="M "+q.x+","+q.y+" A "+this.innerA+","+this.innerB+" 0 "+n+",0 "+r.x+","+r.y+" L "+r.x+","+(r.y+this.projectionThickness)+" A "+this.innerA+","+this.innerB+" 0 "+n+",1 "+q.x+","+(q.y+this.projectionThickness)+" Z",d.outerFace="M "+l.x+","+l.y+" A "+this.outerA+","+this.outerB+" 0 "+n+",0 "+m.x+","+m.y+" L "+m.x+","+(m.y+this.projectionThickness)+" A "+this.outerA+","+this.outerB+" 0 "+n+",1 "+l.x+","+(l.y+this.projectionThickness)+" Z",d.startAngleDegree=b,d.endAngleDegree=b+c,d},isIn:function(a,b){for(var c=0;c<b.length;c++)if(a.Id===b[c].Id)return!0;return!1},getSlicesFragmentOnAngle:function(a,b,c){if(0>b||b>360||0>c||c>360)throw new Error("StarAngleDegree and EndAngleDegree out of range [0,360]");if(b>c)throw new Error("EndAngleDegree should be  greater than StartAngleDegree");for(var d=[],e=0;e<a.fragments.length;e++){var f=a.fragments[e];f.startAngleDegree>=b&&f.endAngleDegree>=b&&f.startAngleDegree<=c&&f.endAngleDegree<=c?d[d.length]=f:f.startAngleDegree<=b&&f.endAngleDegree>=b&&f.startAngleDegree<=c&&f.endAngleDegree<=c?d[d.length]=f:f.startAngleDegree>=b&&f.endAngleDegree>=b&&f.startAngleDegree<=c&&f.endAngleDegree>=c?d[d.length]=f:f.startAngleDegree<=b&&f.endAngleDegree>=b&&f.startAngleDegree<=c&&f.endAngleDegree>=c&&(d[d.length]=f)}return d},getSliceOnAngle:function(a){if(0>a&&a>360)throw new Error("angleDegree out of range [0,360]");for(var b=0;b<this.slices.length;b++){var c=this.slices[b];if(c.endAngleDegree<=360){if(c.startAngleDegree<=a&&c.endAngleDegree>=a)return c}else if(c.endAngleDegree>360){var d=a;a<c.startAngleDegree&&(d=a+360);var e=c.startAngleDegree<=d,f=c.endAngleDegree>=d;if(e&&f)return c}}return void 0},getSlicesOnAngle:function(a){if(0>a&&a>360)throw new Error("angleDegree out of range [0,360]");for(var b=[],c=0;c<this.slices.length;c++){var d=this.slices[c];if(d.endAngleDegree<=360)d.startAngleDegree<=a&&d.endAngleDegree>=a&&(b[b.length]=d);else if(d.endAngleDegree>360){var e=a;a<d.startAngleDegree&&(e=a+360);var f=d.startAngleDegree<=e,g=d.endAngleDegree>=e;f&&g&&(b[b.length]=d)}}return b},getSlicesOnRangeAngle:function(a,b){if(0>a||a>360||0>b||b>360)throw new Error("StarAngleDegree and EndAngleDegree out of range [0,360]");if(a>b)throw new Error("EndAngleDegree should be  greater than StartAngleDegree");for(var c=[],d=0;d<this.slices.length;d++){var e=this.slices[d];e.startAngleDegree>=a&&e.endAngleDegree>=a&&e.startAngleDegree<=b&&e.endAngleDegree<=b?c[c.length]=e:e.startAngleDegree<=a&&e.endAngleDegree>=a&&e.startAngleDegree<=b&&e.endAngleDegree<=b?c[c.length]=e:e.startAngleDegree>=a&&e.endAngleDegree>=a&&e.startAngleDegree<=b&&e.endAngleDegree>=b?c[c.length]=e:e.startAngleDegree<=a&&e.endAngleDegree>=a&&e.startAngleDegree<=b&&e.endAngleDegree>=b&&(c[c.length]=e)}return c},getPaintOrder:function(){this.getPaintOrderFragments();for(var a=[],b=this.getSlicesOnAngle(90),c=this.getSlicesOnAngle(270),d=0;d<b.length;d++)void 0===b[d]||this.isIn(b[d],a)||this.isIn(b[d],c)||(a[a.length]=b[d]);for(var e=this.getSlicesOnRangeAngle(90,270),f=0;f<e.length;f++)this.isIn(e[f],a)||this.isIn(e[f],c)||(a[a.length]=e[f]);var g=this.getSliceOnAngle(0),h=this.getSlicesOnRangeAngle(0,90);h.reverse();for(var i=0;i<h.length;i++)this.isIn(h[i],a)||!h[i].Id!==g.Id||this.isIn(h[i],c)||(a[a.length]=h[i]);void 0===g||this.isIn(g,a)||this.isIn(g,c)||(a[a.length]=g);var j=this.getSlicesOnRangeAngle(270,360);j.reverse();for(var k=0;k<j.length;k++)this.isIn(j[k],a)||this.isIn(j[k],c)||(a[a.length]=j[k]);for(var l=0;l<c.length;l++)void 0!==c[l]&&(a[a.length]=c[l]);return a},getPaintOrderFragments:function(){for(var a=[],b=this.getSlicesOnAngle(90),c=[],d=0;d<b.length;d++)for(var e=b[d],f=e.fragments,g=0;g<f.length;g++)c[c.length]=f[g];for(var h=this.getSlicesOnAngle(270),i=[],d=0;d<h.length;d++)for(var j=h[d],f=j.fragments,g=0;g<f.length;g++)i[i.length]=f[g];for(var d=0;d<c.length;d++){var k=c[d];k.startAngleDegree<=90&&k.endAngleDegree>=90&&(a[a.length]=k)}for(var d=0;d<c.length;d++){var k=c[d];this.isIn(k,a)||this.isIn(k,i)||(a[a.length]=k)}for(var l=this.getSlicesOnRangeAngle(90,270),d=0;d<l.length;d++)for(var m=l[d],f=m.fragments,g=0;g<f.length;g++){var n=f[g];this.isIn(n,a)||this.isIn(n,i)||(a[a.length]=n)}var o=this.getSliceOnAngle(0),p=this.getSlicesOnRangeAngle(0,90);p.reverse();for(var d=0;d<p.length;d++)for(var q=p[d],r=this.getSlicesFragmentOnAngle(q,0,90),g=0;g<r.length;g++){var s=r[g];if(!this.isIn(s,a)&&!this.isIn(s,o.fragments))if(this.isIn(s,i))for(var t=0;t<i.length;t++){var u=i[t];u.Id===s.Id&&"Back"===s.type&&(a[a.length]=s)}else a[a.length]=s}for(var v=o.fragments,d=v.length-1;d>=0;d--){var w=v[d];if(void 0!==w&&!this.isIn(w,a))if(this.isIn(w,i))for(var g=0;g<i.length;g++){var u=i[g];u.Id===w.Id&&"Back"===w.type&&(a[a.length]=w)}else a[a.length]=w}var x=this.getSlicesOnRangeAngle(270,360);x.reverse();for(var d=0;d<x.length;d++)for(var y=x[d],z=this.getSlicesFragmentOnAngle(y,270,360),g=0;g<z.length;g++){var A=z[g];if(!this.isIn(A,a)&&!this.isIn(A,o.fragments))if(this.isIn(A,i))for(var t=0;t<i.length;t++){var u=i[t];u.Id===A.Id&&"Back"===A.type&&(a[a.length]=A)}else a[a.length]=A}for(var d=0;d<i.length;d++){var B=i[d];this.isIn(B,a)||(a[a.length]=B)}return a}})}(),function(){JenScript.Donut3DSlice=function(a){this.init(a)},JenScript.Model.addMethods(JenScript.Donut3DSlice,{init:function(a){if(a=a||{},this.Id="donut3dslice"+JenScript.sequenceId++,this.name=a.name,this.value=void 0!==a.value?a.value:1,this.themeColor=a.themeColor,this.divergence=void 0!==a.divergence?a.divergence:0,this.normalizedValue,this.startAngleDegree,this.endAngleDegree,this.outerArcTop,this.innerArcTop,this.outerArcBottom,this.innerArcBottom,this.topFace,this.bottomFace,this.startFace,this.endFace,this.innerFace,this.outerFace,this.sos,this.soe,this.sis,this.sie,this.sliceLabels=[],this.type,this.isFragment,this.parentSlice,this.innerModel,this.centerX,this.centerY,this.painted=!1,this.lockEnter=!1,this.donut,this.fragments=[],this.value<=0)throw new Error("Slice value should be greater than 0")},setName:function(a){this.name=a},getName:function(){return this.name},setValue:function(a){this.value=a},getValue:function(){return this.value},setDivergence:function(a){this.divergence=a},getDivergence:function(){return this.divergence},setThemeColor:function(a){this.themeColor=a},getThemeColor:function(){return this.themeColor},getSliceLabels:function(){return this.sliceLabels},addSliceLabel:function(a){this.sliceLabels[this.sliceLabels.length]=a,a.slice=this,void 0!==this.donut&&void 0!==this.donut.plugin&&this.donut.plugin.repaintDonuts()},set:function(a,b,c){this.name=a,this.value=b,this.themeColor=c,void 0!==this.donut&&void 0!==this.donut.plugin&&this.donut.plugin.repaintDonuts()},clearFragments:function(){this.fragments=[]},addFragment:function(a){this.fragments[this.fragments.length]=a},isFirst:function(a){return this.fragments[0].Id===a.Id},isLast:function(a){return this.fragments[this.fragments.length-1].Id===a.Id},getFrontInnerFace:function(){for(var a="",b=0;b<this.fragments.length;b++){var c=this.fragments[b];"Front"===c.type&&(a+=c.innerFace)}return a},getBackInnerFace:function(){for(var a="",b=0;b<this.fragments.length;b++){var c=this.fragments[b];"Back"===c.type&&(a+=c.innerFace)}return a}})}(),function(){JenScript.Donut3DDefaultPaint=function(){this.incidenceAngleDegree=90,this.paintTopEffect=!0,this.paintInnerEffect=!0,this.paintOuterEffect=!0,this.alphaTop=.8,this.alphaInner=1,this.alphaOuter=1,this.alphaFill=.7,this.fillBackBottom=!0,this.fillBackOuter=!0,this.fillBackInner=!0,this.fillBackTop=!0,this.fillBackStart=!0,this.fillBackEnd=!0,this.fillFrontBottom=!0,this.fillFrontOuter=!0,this.fillFrontInner=!0,this.fillFrontTop=!0,this.fillFrontStart=!0,this.fillFrontEnd=!0},JenScript.Model.addMethods(JenScript.Donut3DDefaultPaint,{paintDonut3D:function(a,b){for(var c=b.getPaintOrderFragments(),d=0;d<c.length;d++){var e=c[d];this._paintDonut3DFill(a,b,e),this.paintTopEffect&&this._paintTopEffect(a,b,e),this.paintOuterEffect&&this._paintOuterEffect(a,b,e),this.paintInnerEffect&&this._paintInnerEffect(a,b,e),e.painted=!0}},_paintOuterEffect:function(a,b){for(var c=b.getDonutCenter(),d="",e=0;e<b.slices.length;e++)for(var f=b.slices[e].fragments,g=0;g<f.length;g++){var h=f[g];"Front"===h.type&&(d=d+" "+h.outerFace)}var i="gradient"+JenScript.sequenceId++,j=c.x-b.outerA,k=c.y,l=c.x+b.outerA,m=c.y,n=["0%","40%","80%","100%"],o="rgb(40, 40, 40)",p="rgb(40, 40, 40)",q="rgb(255, 255, 255)",r="rgb(255, 255, 255)",s=[o,p,q,r],t=[.3,.05,.05,.5],u=(new JenScript.SVGLinearGradient).Id(i).from(j,k).to(l,m).shade(n,s,t).toSVG();a.definesSVG(u);var v=(new JenScript.SVGElement).name("path").attr("d",d).attr("fill","url(#"+i+")").attr("opacity",this.alphaOuter).buildHTML();b.svg.donutRoot.appendChild(v)},_paintInnerEffect:function(a,b){for(var c="",d=0;d<b.slices.length;d++)for(var e=b.slices[d].fragments,f=0;f<e.length;f++){var g=e[f];"Back"===g.type&&(c=c+" "+g.innerFace)}var h="clip"+JenScript.sequenceId++,i=(new JenScript.SVGElement).name("clipPath").attr("id",h).buildHTML(),j=b.getDonutCenter(),k=(new JenScript.SVGElement).name("ellipse").attr("cx",j.x).attr("cy",j.y).attr("rx",b.innerA).attr("ry",b.innerB).buildHTML();i.appendChild(k),a.definesSVG(i);var l=j.x+b.innerA,m=j.y,n=j.x-b.innerA,o=j.y,p=["0%","40%","80%","100%"],q="rgb(40, 40, 40)",r="rgb(40, 40, 40)",s="rgb(240, 240, 240)",t="rgb(240, 240, 240)",u=[q,r,s,t],v=[.2,.3,0,.6],w="gradient"+JenScript.sequenceId++,x=(new JenScript.SVGLinearGradient).Id(w).from(l,m).to(n,o).shade(p,u,v).toSVG();a.definesSVG(x);var y=(new JenScript.SVGElement).name("path").attr("d",c).attr("clip-path","url(#"+h+")").attr("fill","url(#"+w+")").attr("opacity",this.alphaInner).buildHTML();b.svg.donutRoot.appendChild(y)},paintEndEffect:function(){},_paintTopEffect:function(a,b,c){var d=b.getDonutCenter(),e=b.getSliceOnAngle(this.incidenceAngleDegree),f=e.divergence/90,g=f*b.tilt,h=e.divergence,i=g,j=d.x+h*Math.cos(JenScript.Math.toRadians(e.startAngleDegree+Math.abs(e.endAngleDegree-e.startAngleDegree)/2)),k=d.y-i*Math.sin(JenScript.Math.toRadians(e.startAngleDegree+Math.abs(e.endAngleDegree-e.startAngleDegree)/2)),l=j+b.outerA*Math.cos(JenScript.Math.toRadians(this.incidenceAngleDegree)),m=k-b.outerB*Math.sin(JenScript.Math.toRadians(this.incidenceAngleDegree)),n=b.getSliceOnAngle(this.incidenceAngleDegree+180),o=n.divergence/90,p=o*b.tilt,q=n.divergence,r=p,s=d.x+q*Math.cos(JenScript.Math.toRadians(n.startAngleDegree+Math.abs(n.endAngleDegree-n.startAngleDegree)/2)),t=d.y-r*Math.sin(JenScript.Math.toRadians(n.startAngleDegree+Math.abs(n.endAngleDegree-n.startAngleDegree)/2)),u=s+b.outerA*Math.cos(JenScript.Math.toRadians(this.incidenceAngleDegree+180)),v=t-b.outerB*Math.sin(JenScript.Math.toRadians(this.incidenceAngleDegree+180)),w="rgb(40, 40, 40)",x="rgb(40, 40, 40)",y="rgb(255, 255, 255)",z="rgb(255, 255, 255)",A=["0%","45%","55%","100%"],B=[w,x,y,z],C=[.5,0,0,.8],D="gradient"+JenScript.sequenceId++,E=(new JenScript.SVGLinearGradient).Id(D).from(l,m).to(u,v).shade(A,B,C).toSVG();if(a.definesSVG(E),void 0!==c&&void 0!==c.topFace){var F=(new JenScript.SVGElement).name("path").attr("d",c.topFace).attr("opacity",this.alphaTop).attr("fill","url(#"+D+")").buildHTML();b.svg.donutRoot.appendChild(F)}},_paintDonut3DFill:function(a,b,c){if(this.fillBackOuter&&"Back"===c.type){var d=(new JenScript.SVGElement).name("path").attr("d",c.outerFace).attr("opacity",this.alphaFill).attr("fill",c.themeColor).buildHTML();b.svg.donutRoot.appendChild(d)}if(this.fillBackBottom&&"Back"===c.type){var e=(new JenScript.SVGElement).name("path").attr("d",c.bottomFace).attr("opacity",this.alphaFill).attr("fill",c.themeColor).buildHTML();b.svg.donutRoot.appendChild(e)}if(this.fillBackInner&&"Back"==c.type){var f="clip"+JenScript.sequenceId++,g=(new JenScript.SVGElement).name("clipPath").attr("id",f).buildHTML(),h=(new JenScript.SVGElement).name("path").attr("d",b.getTopFace()).buildHTML();g.appendChild(h),a.definesSVG(g);var i=(new JenScript.SVGElement).name("path").attr("d",c.innerFace).attr("opacity",this.alphaFill).attr("fill",c.themeColor).buildHTML();b.svg.donutRoot.appendChild(i)}if(this.fillBackStart&&"Back"===c.type&&c.parentSlice.isFirst(c)){var j=(new JenScript.SVGElement).name("path").attr("d",c.startFace).attr("opacity",this.alphaFill).attr("fill",c.themeColor).buildHTML();b.svg.donutRoot.appendChild(j),c.parentSlice.isFirst(c)&&(c.parentSlice.startAngleDegree<=90||c.parentSlice.startAngleDegree>=270)}if(this.fillBackEnd&&"Back"===c.type&&c.parentSlice.isLast(c)){var k=(new JenScript.SVGElement).name("path").attr("d",c.endFace).attr("opacity",this.alphaFill).attr("fill",c.themeColor).buildHTML();b.svg.donutRoot.appendChild(k),c.parentSlice.isLast(c)&&c.endAngleDegree>=90&&c.endAngleDegree<=270}if(this.fillBackTop&&"Back"===c.type){var l=(new JenScript.SVGElement).name("path").attr("d",c.topFace).attr("opacity",this.alphaFill).attr("fill",c.themeColor).buildHTML();b.svg.donutRoot.appendChild(l)}if(this.fillFrontInner&&"Front"===c.type){var m=(new JenScript.SVGElement).name("path").attr("d",c.innerFace).attr("opacity",this.alphaFill).attr("fill",c.themeColor).buildHTML();b.svg.donutRoot.appendChild(m)}if(this.fillFrontBottom&&"Front"===c.type){var e=(new JenScript.SVGElement).name("path").attr("d",c.bottomFace).attr("opacity",this.alphaFill).attr("fill",c.themeColor).buildHTML();b.svg.donutRoot.appendChild(e)}if(this.fillFrontStart&&"Front"===c.type&&c.parentSlice.isFirst(c)){var j=(new JenScript.SVGElement).name("path").attr("d",c.startFace).attr("opacity",this.alphaFill).attr("fill",c.themeColor).buildHTML();b.svg.donutRoot.appendChild(j),c.parentSlice.isFirst(c)&&(c.startAngleDegree<90||c.startAngleDegree>270)}if(this.fillFrontEnd&&"Front"===c.type&&c.parentSlice.isLast(c)){var k=(new JenScript.SVGElement).name("path").attr("d",c.endFace).attr("opacity",this.alphaFill).attr("fill",c.themeColor).buildHTML();b.svg.donutRoot.appendChild(k),c.parentSlice.isLast(c)&&c.endAngleDegree>90&&c.endAngleDegree<270}if(this.fillFrontOuter&&"Front"===c.type){var d=(new JenScript.SVGElement).name("path").attr("d",c.outerFace).attr("opacity",this.alphaFill).attr("fill",c.themeColor).buildHTML();b.svg.donutRoot.appendChild(d)}if(this.fillFrontTop&&"Front"===c.type){var l=(new JenScript.SVGElement).name("path").attr("d",c.topFace).attr("opacity",this.alphaFill).attr("fill",c.themeColor).buildHTML();b.svg.donutRoot.appendChild(l)}}})}(),function(){JenScript.Donut3DAbstractLabel=function(a){this._init(a)},JenScript.Model.inheritPrototype(JenScript.Donut3DAbstractLabel,JenScript.AbstractLabel),JenScript.Model.addMethods(JenScript.Donut3DAbstractLabel,{_init:function(a){JenScript.AbstractLabel.call(this,a)},paintDonut3DSliceLabel:function(){throw new Error("paintDonut3DSliceLabel method should be provide by override")}}),JenScript.Donut3DBorderLabel=function(a){this.__init(a)},JenScript.Model.inheritPrototype(JenScript.Donut3DBorderLabel,JenScript.Donut3DAbstractLabel),JenScript.Model.addMethods(JenScript.Donut3DBorderLabel,{__init:function(a){a=a||{},this.margin=void 0!==a.margin?a.margin:50,this.linkExtends=void 0!==a.linkExtends?a.linkExtends:30,a.name="JenScript.Donut3DBorderLabel",JenScript.Donut3DAbstractLabel.call(this,a)},setMargin:function(a){this.margin=a;var b=this.slice.donut.plugin.getGraphicsContext(JenScript.ViewPart.Device);this.paintDonut3DSliceLabel(b,this.slice)},setLinkExtends:function(a){this.linkExtends=a;var b=this.slice.donut.plugin.getGraphicsContext(JenScript.ViewPart.Device);this.paintDonut3DSliceLabel(b,this.slice)},paintDonut3DSliceLabel:function(a,b){var c=b.donut.getDonutCenter(),d=b.startAngleDegree+Math.abs(b.endAngleDegree-b.startAngleDegree)/2;d>=360&&(d-=360);var e=c.x+(b.donut.outerA+b.divergence)*Math.cos(JenScript.Math.toRadians(d)),f=c.y-(b.donut.outerB+b.divergence)*Math.sin(JenScript.Math.toRadians(d)),g=c.x+(b.donut.outerA+this.linkExtends+b.divergence)*Math.cos(JenScript.Math.toRadians(d)),h=c.y-(b.donut.outerB+this.linkExtends+b.divergence)*Math.sin(JenScript.Math.toRadians(d)),i=0,j=h,k=0,l=h,m="middle";d>=270&&360>=d||d>=0&&90>=d?(i=c.x+b.donut.outerA+this.margin-5,k=c.x+b.donut.outerA+this.margin+5,m="start",270===d&&(m="middle"),90===d&&(m="middle")):(i=c.x-b.donut.outerA-this.margin+5,k=c.x-b.donut.outerA-this.margin-5,m="end");var n="M "+e+","+f+" Q "+g+","+h+" "+i+","+j,o=(new JenScript.SVGElement).name("path").attr("d",n).attr("fill","none").attr("stroke","darkgray").buildHTML();this.setTextAnchor(m),this.setLocation(new JenScript.Point2D(k,l));var p=void 0!==this.textColor?this.textColor:b.themeColor;this.setTextColor(p),this.paintLabel(a),this.svg.label.appendChild(o)}}),JenScript.Donut3DRadialLabel=function(a){this.__init(a)},JenScript.Model.inheritPrototype(JenScript.Donut3DRadialLabel,JenScript.Donut3DAbstractLabel),JenScript.Model.addMethods(JenScript.Donut3DRadialLabel,{__init:function(a){a=a||{},this.offsetRadius=void 0!==a.offsetRadius?a.offsetRadius:20,a.name="JenScript.Donut3DRadialLabel",JenScript.Donut2DAbstractLabel.call(this,a)},setOffsetRadius:function(a){this.offsetRadius=a,this.slice.donut.plugin.repaintPlugin()},paintDonut3DSliceLabel:function(a,b){var c={x:b.sc.x+(b.donut.outerA+this.offsetRadius)*Math.cos(JenScript.Math.toRadians(b.medianDegree)),y:b.sc.y-(b.donut.outerB+this.offsetRadius)*Math.sin(JenScript.Math.toRadians(b.medianDegree))},d="middle",e=0;b.medianDegree>0&&b.medianDegree<90?(d="start",e=10):b.medianDegree>90&&b.medianDegree<270?(d="end",e=-10):b.medianDegree>270&&b.medianDegree<=360?(d="start",e=10):(90===b.medianDegree||270===b.medianDegree)&&(d="middle"),this.setLocation(new JenScript.Point2D(c.x,c.y)),this.setTextAnchor(d);var f=void 0!==this.textColor?this.textColor:b.themeColor;this.setTextColor(f),this.paintLabel(a)}})}(),function(){JenScript.Donut3DBuilder=function(a,b,c){a.registerProjection(b);var d=new JenScript.Donut3DPlugin;b.registerPlugin(d);var e=new JenScript.Donut3D(c);d.addDonut(e);var f,g=[],h=[],i=function(a){var b=new JenScript.Donut3DSlice(a);return f=b,e.addSlice(b),h.push(b),this},j=function(a,b){var c;return"radial"===a&&(c=new JenScript.Donut3DRadialLabel(b)),"border"===a&&(c=new JenScript.Donut3DBorderLabel(b)),f.addSliceLabel(c),g.push(c),this},k=function(a,b){var c;return"reflection"===a&&(c=new JenScript.Donut3DReflectionEffect(b)),e.addEffect(c),effects.push(c),this},l=function(a){return k("reflection",a),this};return{slice:i,label:j,effect:k,reflectFx:l,view:function(){return a},projection:function(){return b},donut:function(){return e},labels:function(){return g},slices:function(){return i}}}}(),function(){JenScript.AbstractDonut3DEffect=function(a){this.init(a)},JenScript.Model.addMethods(JenScript.AbstractDonut3DEffect,{init:function(a){a=a||{},this.name=a.name},effectDonut3D:function(){}}),JenScript.Donut3DReflectionEffect=function(a){this._init(a)},JenScript.Model.inheritPrototype(JenScript.Donut3DReflectionEffect,JenScript.AbstractDonut3DEffect),JenScript.Model.addMethods(JenScript.Donut3DReflectionEffect,{_init:function(a){a=a||{},this.deviation=void 0!==a.deviation?a.deviation:3,this.opacity=void 0!==a.opacity?a.opacity:.3,this.length=void 0!==a.length?a.length:.5,this.verticalOffset=void 0!==a.verticalOffset?a.verticalOffset:0,a.name="JenScript.Donut3DReflectionEffect",JenScript.AbstractDonut3DEffect.call(this,a)},effectDonut3D:function(a,b){var c=b.svg.donutRoot.getBBox(),d="clip"+JenScript.sequenceId++,e=(new JenScript.SVGRect).origin(c.x,c.y+c.height).size(c.width,c.height*this.length),f=(new JenScript.SVGClipPath).Id(d).appendPath(e);a.definesSVG(f.toSVG());var g="filter"+JenScript.sequenceId++,h=(new JenScript.SVGFilter).Id(g).from(c.x,c.y).size(c.width,c.height).toSVG(),i=(new JenScript.SVGElement).name("feGaussianBlur").attr("in","SourceGraphic").attr("stdDeviation",this.deviation);h.appendChild(i.buildHTML()),a.definesSVG(h);var j=b.svg.donutRoot.cloneNode(!0);j.removeAttribute("id"),j.setAttribute("filter","url(#"+g+")"),j.setAttribute("transform","translate(0,"+c.height+"), scale(1,-1), translate(0,"+(-2*(c.y+c.height/2)-this.verticalOffset)+")"),j.setAttribute("opacity",this.opacity);var k=(new JenScript.SVGElement).name("g").buildHTML();j.setAttribute("id",j.getAttribute("id")+"_reflection"+JenScript.sequenceId++),k.setAttribute("clip-path","url(#"+d+")"),k.appendChild(j),a.insertSVG(k)}})}();